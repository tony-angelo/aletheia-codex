swagger: '2.0'
info:
  title: Aletheia Codex API Gateway
  description: API Gateway for Aletheia Codex backend services - provides public access to Cloud Functions while maintaining security
  version: 1.0.0
host: aletheia-codex-gateway-REPLACE.uc.gateway.dev
schemes:
  - https
produces:
  - application/json
consumes:
  - application/json

# Security: All endpoints require Firebase Authentication token
securityDefinitions:
  firebase:
    authorizationUrl: ""
    flow: "implicit"
    type: "oauth2"
    x-google-issuer: "https://securetoken.google.com/aletheia-codex-prod"
    x-google-jwks_uri: "https://www.googleapis.com/service_accounts/v1/metadata/x509/securetoken@system.gserviceaccount.com"
    x-google-audiences: "aletheia-codex-prod"

security:
  - firebase: []

paths:
  # Review API Endpoints
  /api/review/pending:
    get:
      summary: Get pending review items
      description: Retrieve items pending review for the authenticated user
      operationId: getReviewPending
      security:
        - firebase: []
      x-google-backend:
        address: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
      parameters:
        - name: limit
          in: query
          type: integer
          description: Maximum number of items to return
        - name: min_confidence
          in: query
          type: number
          description: Minimum confidence score
        - name: type
          in: query
          type: string
          enum: [entity, relationship]
          description: Type of items to retrieve
        - name: order_by
          in: query
          type: string
          description: Field to order by
        - name: descending
          in: query
          type: boolean
          description: Sort in descending order
      responses:
        200:
          description: Success
          schema:
            type: object
            properties:
              success:
                type: boolean
              data:
                type: array
        401:
          description: Unauthorized
        403:
          description: Forbidden

  /api/review/approve:
    post:
      summary: Approve a review item
      description: Approve a single item in the review queue
      operationId: approveReviewItem
      security:
        - firebase: []
      x-google-backend:
        address: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              item_id:
                type: string
      responses:
        200:
          description: Success
        401:
          description: Unauthorized
        403:
          description: Forbidden

  /api/review/reject:
    post:
      summary: Reject a review item
      description: Reject a single item in the review queue
      operationId: rejectReviewItem
      security:
        - firebase: []
      x-google-backend:
        address: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              item_id:
                type: string
              reason:
                type: string
      responses:
        200:
          description: Success
        401:
          description: Unauthorized
        403:
          description: Forbidden

  /api/review/batch-approve:
    post:
      summary: Batch approve review items
      description: Approve multiple items in the review queue
      operationId: batchApproveReviewItems
      security:
        - firebase: []
      x-google-backend:
        address: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              item_ids:
                type: array
                items:
                  type: string
      responses:
        200:
          description: Success
        401:
          description: Unauthorized
        403:
          description: Forbidden

  /api/review/batch-reject:
    post:
      summary: Batch reject review items
      description: Reject multiple items in the review queue
      operationId: batchRejectReviewItems
      security:
        - firebase: []
      x-google-backend:
        address: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              item_ids:
                type: array
                items:
                  type: string
              reason:
                type: string
      responses:
        200:
          description: Success
        401:
          description: Unauthorized
        403:
          description: Forbidden

  /api/review/stats:
    get:
      summary: Get user review statistics
      description: Get statistics for the authenticated user's review activity
      operationId: getReviewStats
      security:
        - firebase: []
      x-google-backend:
        address: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: https://us-central1-aletheia-codex-prod.cloudfunctions.net/review-api-function
      responses:
        200:
          description: Success
          schema:
            type: object
        401:
          description: Unauthorized
        403:
          description: Forbidden

  # Graph API Endpoints
  /api/graph:
    get:
      summary: Get knowledge graph nodes
      description: Retrieve nodes from the knowledge graph for the authenticated user
      operationId: getGraphNodes
      security:
        - firebase: []
      x-google-backend:
        address: https://us-central1-aletheia-codex-prod.cloudfunctions.net/graph-function
        path_translation: APPEND_PATH_TO_ADDRESS
        jwt_audience: https://us-central1-aletheia-codex-prod.cloudfunctions.net/graph-function
      parameters:
        - name: limit
          in: query
          type: integer
          description: Maximum number of nodes to return
          default: 50
        - name: offset
          in: query
          type: integer
          description: Number of nodes to skip
          default: 0
        - name: type
          in: query
          type: string
          description: Filter by node type
        - name: nodeId
          in: query
          type: string
          description: Get specific node details by ID
        - name: query
          in: query
          type: string
          description: Search query string
        - name: search
          in: query
          type: string
          description: Enable search mode
      responses:
        200:
          description: Success
          schema:
            type: object
            properties:
              nodes:
                type: array
              total:
                type: integer
        401:
          description: Unauthorized
        403:
          description: Forbidden
        404:
          description: Node not found